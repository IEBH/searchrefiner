<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CiteMed - Tree Editor</title>
    <link rel="stylesheet" href="static/spectre.min.css" type="text/css">
    <link rel="stylesheet" href="static/spectre-icons.min.css" type="text/css">
    <link rel="stylesheet" href="static/spectre-exp.min.css" type="text/css">
    <link rel="stylesheet" href="static/vis.min.css" type="text/css">
    <link rel="stylesheet" href="static/citemed.css" type="text/css">
    <style>
        #tree {
            width: 100%;
            height: 100%;
        }

        #tree-wrapper {
            background-color: #f9f9f9;
            height: 100%;
        }

        textarea {
            padding: 0;
            margin: 0;
        }


    </style>
</head>
<body>
<div class="container">
    <div class="columns">
        <div class="column col-4">
            <div class="form-group">
                    <textarea name="query" class="form-input" id="search-box" placeholder="Enter query here."
                              rows="20" required></textarea>
                <button class="btn btn-primary form-input" type="button" id="submit">Visualise</button>
                <button class="btn btn-text form-input" type="button" id="edit">Edit</button>
                <button class="btn btn-text form-input" type="button" id="explore">Explore</button>
            </div>
        </div>
        <div class="column col-8">
            <div id="tree-wrapper">
                <div id="tree" class="c-move"></div>
            </div>
        </div>
    </div>
</div>

<script src="static/vis.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // create an array with nodes
    var nodes = new vis.DataSet([]);

    // create an array with edges
    var edges = new vis.DataSet([]);

    // create a network
    var container = document.getElementById('tree');

    // provide the data in the vis format
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        physics: {
            enabled              : true,
            hierarchicalRepulsion: {
                nodeDistance: 200
            }
        },
        edges  : {
            font  : {
                align: "top"
            },
            smooth: {
                enabled: true,
                type   : "dynamic"
            }
        },
        nodes  : {
            shape          : "box",
            color          : "#CED2FF",
            font           : {
                color: "#333333"
            },
            scaling        : {
                customScalingFunction: function (min, max, total, value) {
                    return value / total;
                },
                min                  : 10,
                max                  : 80,
                label                : {
                    enabled: true,
                    min    : 20,
                    max    : 100
                }
            },
            widthConstraint: true
        },
        layout : {
            hierarchical: {
                enabled             : true,
                blockShifting       : false,
                edgeMinimization    : false,
                parentCentralization: false,
                nodeSpacing         : 600
            }
        }
    };

    // initialize your network!
    var network = new vis.Network(container, data, options);
</script>
<script>
    var submitEl = document.getElementById("submit");
    var searchEl = document.getElementById("search-box");

    submitEl.addEventListener("click", function () {
        submitEl.classList.add("loading");
        submitEl.disabled = true;
        searchEl.disabled = true;
        var request = new XMLHttpRequest();
        request.addEventListener("load", function (ev) {
            network.setData(JSON.parse(ev.target.responseText));
            submitEl.classList.remove("loading");
            submitEl.disabled = false;
            searchEl.disabled = false;
        });
        request.open("POST", "http://localhost:8080/api/tree", true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        request.send("query=" + searchEl.value);
    })
</script>
<script>
    var editEl = document.getElementById("edit");
    var exploreEl = document.getElementById("explore");

    editEl.addEventListener("click", function () {
        openWindowWithPost("/transform", searchEl.value)
    });

    exploreEl.addEventListener("click", function () {
        openWindowWithPost("/query", searchEl.value)
    });

    function openWindowWithPost(url, data) {
        var form = document.createElement("form");
        form.target = "_blank";
        form.method = "POST";
        form.action = url;
        form.style.display = "none";

        var input = document.createElement("input");
        input.type = "hidden";
        input.name = "query";
        input.value = data;
        form.appendChild(input);

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
    }

</script>
</body>
</html>